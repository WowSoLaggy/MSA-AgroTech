### **Документ:** ADR_03

### **Название задачи:** Разработка С3 (диаграммы компонент) и С4 (диаграммы кода) для платформы мониторинга поголовья скота.

### **Автор:** Егоров Антон
### **Дата:** 03.11.2025


### **Проблема**

См. [ADR_01](./../Task1/adr_01.md)
Решение на уровне С2 представлено в [ADR_02](./../Task2/adr_02.md)


### **Функциональные требования**

См. [ADR_01](./../Task1/adr_01.md)


### **Нефункциональные требования**

См. [ADR_01](./../Task1/adr_01.md)


### **Решение**

Для удобства чтения контейнерной диаграммы, она была разделена на две части:
- **Центральная система** - отвечает за сбор данных от отдельных ферм, предоставляет доступ к управлению фермами.
- **Система агента** (отдельной фермы) - отвечает за работу отдельной фермы, собирает данные с датчиков, нотифицирует дежурный персонал, способна к автономной работе в случае отсутствия интернета.

#### **Контейнерная диаграмма центральной системы**

![контейнерная диаграмма центральной системы](./container_central.png)

#### **Контейнерная диаграмма системы агента**

![контейнерная диаграмма системы агента](./container_agent.png)

- Было решено использовать собственный брокер сообщений в агентской системе для коммуникации между датчиками (видеокамерами, системами кормления и водоснабжения) и локальным сервером агента. Это позволяет обеспечить надёжную и масштабируемую коммуникацию между компонентами, а также упростить интеграцию новых типов датчиков в будущем.
- Контейнер _On-site Notification Service_ абстрагирует работу с различными системами оповещения на ферме, которые могут сильно различаться в зависимости от конкретной фермы и её инфраструктуры. Это позволяет легко интегрировать новые методы оповещения без необходимости изменения основной логики системы.
- Дежурный персонал фермы (_Farm Supervisor_) получает уведомления и оповещения от локального сервера агента, что позволяет оперативно реагировать на нештатные ситуации даже в случае отсутствия интернета. В свою очередь, менеджер ферм (_Farm Operations Manager_) получает оповещения от центральной системы, что позволяет ему контролировать состояние всех ферм в системе, допуская задержки в синхронизации до 10 минут.
- Данное решение не поддерживает хранение видео данных, только их аналитику. Это позволяет снизить требования к хранилищу и упростить архитектуру системы, сосредоточив внимание на оперативном мониторинге и анализе данных.
- Коммуникация между центральной системой и системой агента двусторонняя:
  - Центральная система получает агрегированные данные и метрики от системы агента для анализа и отчётов.
  - Система агента получает обновления конфигурации и команды управления от центральной системы, что позволяет централизованно управлять настройками и поведением агентов на фермах.
- Коммуникация между центральной системой и системой агента осуществляется через асинхронные сообщения с использованием брокера сообщений (_Message Broker_). Это обеспечивает надёжную доставку сообщений и позволяет системе функционировать даже при временных сбоях в сети.
- Управление системами конкретной фермы осуществляется через приложения (_Mobile App_ или _Web App_), которые взаимодействуют с центральной системой. Это позволяет упростить разработку пользовательских интерфейсов и обеспечить единый доступ к данным и управлению фермами, допуская задержки в синхронизации управления до 10 минут.

### **Альтернативы**

- Использование единой централизованной системы оповещений для всех ферм. Однако это решение не учитывает возможные проблемы с интернет-соединением на отдельных фермах, что может привести к задержкам в получении критически важных оповещений.
- Коммуникацию между центральной системой и системой агента можно было бы реализовать синхронной, но это увеличило бы зависимость от стабильного интернет-соединения и снизило бы общую надёжность системы.
- Можно упростить архитектуру агента, убрав брокер сообщений и управляющий контейнер - в таком случае все компоненты будут напрямую взаимодействовать с сервисом оповещений и отсылать данные в центральную систему. Однако это усложнит масштабирование и интеграцию новых компонентов в будущем, добавляя дублирование логики взаимодействия в каждом компоненте. Ниже представлена альтернативная диаграмма контейнеров для системы агента без брокера сообщений и управляющего контейнера:

![контейнерная диаграмма системы агента (альтернатива)](./container_agent_alt.png)


**Недостатки, ограничения, риски**

- На ферме должна быть готовая инфраструктура для оповещений, даже в случае отсутствия интернета.
