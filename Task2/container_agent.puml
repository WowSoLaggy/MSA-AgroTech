@startuml container_agent.puml
title Livestock Monitoring System - Container Diagram (Agent Side)

top to bottom direction

!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Component.puml

' Actors

Person(farm_supervisor, "Farm Supervisor", "Manages and monitors livestock and farm systems on-site")

' External Systems

System_Ext(video_analytics_ext, "Video Analytics System", "Provides video feed")
System_Ext(local_notification_ext, "Local Notification System", "Sends alerts to farm staff via SMS/Email/Push")
System_Ext(neural_network_ext, "Neural Network Service", "Processes video feeds for anomaly detection / counting")
System_Ext(feeder_system_ext, "Feeder Control System", "Manages automated feeding systems")
System_Ext(water_system_ext, "Water Filtering System", "Manages water quality systems")

' LMS

System_Boundary(lms_boundary, "Livestock Monitoring System") {

  Container(broker, "Message Broker", "RabbitMQ", "Handles communication between central system and farm systems.")

  ' Farm System Boundary

  System_Boundary(system_farm, "Agent System (Farm)") {
    System_Boundary(edge_devices_boundary, "Edge Devices Controllers") {
      Container(video_analytics, "Video Analytics", "C++", "Integrates with external video analytics system, analyzes video feeds")
      Container(feeder_controller, "Feeder Controller", "Python", "Controls automated feeding systems")
      Container(water_controller, "Water System Controller", "Python", "Controls water quality systems")
    }
    Container(agent_broker, "Agent Message Broker", "RabbitMQ", "Handle communication between containers of the single farm")
    Container(agent_management_app, "Farm Management App", "Python", "A single entry point for the farm management")
    Container(agent_notifier, "Agent Notification Service", "Python", "Sends and logs local alerts to farm staff")
    ContainerDb(db_farm, "Farm Database", "PostgreSQL", "Stores local farm data and device states")

    Rel(video_analytics_ext, video_analytics, "Sends video feeds", "RTSP / ONVIF")
    Rel(neural_network_ext, video_analytics, "Provides video analysis", "gRPC")
    Rel(feeder_system_ext, feeder_controller, "Provides feeder metrics and control", "TBD")
    Rel(water_system_ext, water_controller, "Provides water quality metrics and control", "TBD")
    Rel(video_analytics, agent_broker, "Sends data, receives commands", "MQTT")
    Rel(feeder_controller, agent_broker, "Sends data, receives commands", "MQTT")
    Rel(water_controller, agent_broker, "Sends data, receives commands", "MQTT")
    Rel(agent_broker, agent_management_app, "Is read by, gets commands from", "MQTT")
    Rel(agent_management_app, agent_notifier, "Sends alerts to", "JSON / HTTPS")
    Rel(agent_management_app, db_farm, "Read from / writes to", "SQL / TCP")
    Rel(agent_management_app, broker, "Sends data, receives commands", "MQTT")
    Rel(agent_notifier, local_notification_ext, "Sends alerts and notifications", "JSON / HTTPS")
    Rel(local_notification_ext, farm_supervisor, "Sends alerts and notifications", "SMS/Email/Push")
  }
}



@enduml
